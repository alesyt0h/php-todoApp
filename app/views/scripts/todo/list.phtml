<?php
echo $_SESSION['error'] ?? '';
unset($_SESSION['error']);

$reqFrom = $_SERVER['REQUEST_URI'] ?? '';
$reqFrom = preg_match('/\/todo\/list/', $reqFrom);
?>
<!-- This was for show the table as absolute on homepage and relative in /todo/list -->
<!-- <table style="border: 1px solid black" <?php echo (!$reqFrom) ? "class='todo-table table-auto'" : ''; ?>> -->

<?php if (count($this->userTodos ?? [])) { ?>
    <div class="flex flex-col">
        <div class="-my-2 overflow-visible sm:-mx-6 lg:-mx-8">
            <div class="py-2 align-middle inline-block min-w-full sm:px-6 lg:px-8">
                <div class="shadow overflow-visible border-b border-gray-200 sm:rounded-lg">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="relative px-6 py-3">
                                    <input id="master-checker" name="master-checker" type="checkbox" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded">
                                </th>
                                <th scope="col" class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider max-w-[100px]">
                                    Title
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Created
                                </th>
                                <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Status
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Actions
                                </th>
                            </tr>
                        </thead>

                        <tbody class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <input id="" name="status-checker" type="checkbox" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded">
                                    </td>
                                    <td class="px-2 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="relative w-[400px]">
                                                <div id="title" class="title-wrap text-left text-sm font-medium truncate hover:absolute hover:top-[-12px] hover:rounded-[1px] hover:shadow-[0_0_4px_0_black] hover:bg-white hover:z-50 hover:whitespace-normal"></div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-left">
                                        <div class="text-sm text-gray-900">
                                            <span class="text-sm text-gray-500" id="created"></span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-center">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full " id="status"></span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="relative  flex items-center">
                                            <a href="<?php echo WEB_ROOT . '/todo/edit/'; ?>" class="edit mr-2"></a>
                                            <a href="<?php echo '?delete='; ?>" class="trash"></a>
                                        </div>
                                    </td>
                                </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script id="todosRef"> todos = <?php echo json_encode($this->userTodos); ?>; </script>

    <?php echo $this->appendScript('listHelpers.js'); ?>

    <script>
        // Render list
        init();
        document.querySelector('#todosRef').remove();
        delete todos;
        removeOverflowEffect();
    </script>

<?php } else {
    echo 'Try to add some TODO see it here!!';
} ?>

<?php
    if (isset($_GET['delete']) || isset($_GET['assign'])) {
        echo $this->_renderViewScript('global/modal.phtml', true);
    }
?>